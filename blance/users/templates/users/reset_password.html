<!-- reset_password.html -->
{% extends "base.html" %}

{% block resetpassword %}
  <meta charset="UTF-8">
  <title>Відновлення пароля</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      height: 100%;
      background: linear-gradient(135deg, #32CD32, #006400);
    }

    .main-content {
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }

    @keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.reset-password-container {
  background-color: #fff;
  padding: 40px 30px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  width: 100%;
  max-width: 400px;
  text-align: center;
  margin-top: 40px;
  animation: fadeInUp 0.8s ease-out;
}


    .reset-password-container h2 {
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }

    .reset-password-container input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    #reset-password-button,
    .button1 {
      width: 100%;
      padding: 12px;
      background-color: #32CD32;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #reset-password-button:hover,
    .button1:hover {
      background-color: #2aaf2a;
    }

    .divider {
      margin: 20px 0;
      position: relative;
      text-align: center;
    }

    .divider__text {
      background: #fff;
      padding: 0 10px;
      color: #999;
      z-index: 1;
    }

    .divider::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 1px;
      background: #ccc;
      z-index: 0;
    }
  </style>
</head>
<body>
  <div class="main-content">
    <div class="reset-password-container">
      <form id="resetPasswordForm" autocomplete="off">
        {% csrf_token %}
        <h2>Відновлення пароля</h2>
        <input type="password" id="new-password" placeholder="Новий пароль" required><br>
        <input type="password" id="confirm-new-password" placeholder="Підтвердити новий пароль" required><br>
        <button type="submit" id="reset-password-button">Змінити пароль</button>
        <div class="divider">
          <span class="divider__text">або</span>
        </div>
        <button class="button1" onclick="switchBackToLoginAfterRecovery();">Авторизуватися</button>
        <p id="reset-password-message"></p>
      </form>
    </div>
  </div>
</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const resetForm = document.getElementById('resetPasswordForm');
    const resetButton = document.getElementById('reset-password-button');
    const resetMessage = document.getElementById('reset-password-message');

    resetButton.addEventListener('click', function (e) {
        e.preventDefault();

        const password = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-new-password').value;
        const uid = "{{ uid }}"; // передані через render
        const token = "{{ token }}";

        if (password !== confirmPassword) {
            resetMessage.textContent = "Паролі не співпадають.";
            resetMessage.style.color = "red";
            return;
        }

        fetch('/api/password/reset/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                uid: uid,
                token: token,
                password: password,
            }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                resetMessage.textContent = data.success;
                resetMessage.style.color = "green";
                // Перенаправити користувача на вхід через 2 секунди
                setTimeout(() => {
                    window.location.href = '/';
                }, 3000);
            } else if (data.error) {
                resetMessage.textContent = data.error;
                resetMessage.style.color = "red";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            resetMessage.textContent = "Сталася помилка. Спробуйте ще раз.";
            resetMessage.style.color = "red";
        });
    });
});
</script>
{% endblock %}
